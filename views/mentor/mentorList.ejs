<%- layout('/layouts/boilerplate.ejs') -%>
<div class="container py-5">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% if (mentors.length > 0) { %>
            <% mentors.forEach(mentor => { 
                const shortBio = mentor.bio ? mentor.bio.split(" ").slice(0, 13).join(" ") + "..." : "No bio available";
            %> 
                <div class="col">
                    <div class="card h-100 border-0 shadow-sm hover-shadow transition rounded-4 p-3 d-flex flex-column">
                        <div class="card-body d-flex flex-column">
                            
                            <!-- Profile Picture + Name -->
                            <div class="d-flex align-items-center mb-3">
                                <div class="rounded-circle overflow-hidden me-3" style="width: 60px; height: 60px;">
                                    <img src="<%= mentor.userId.profilePicture ? mentor.userId.profilePicture.url : '/placeholder.svg' %>" 
                                         alt="<%= mentor.userId.name %>" 
                                         class="w-100 h-100" 
                                         style="object-fit: cover;">
                                </div>
                                <div>
                                    <h5 class="card-title mb-0 fw-semibold text-dark"><%= mentor.userId.name %></h5>
                                </div>
                            </div>

                            <!-- Truncated Bio -->
                            <p class="card-text text-muted mb-3" style="flex-grow: 1;">
                                <%= shortBio %>
                                <% if (mentor.bio && mentor.bio.split(" ").length > 13) { %>
                                    <a href="#" 
                                       class="text-primary fw-medium text-decoration-none view-more-link" 
                                       data-bs-toggle="modal" 
                                       data-bs-target="#mentorModal-<%= mentor._id %>">
                                        View more <i class="bi bi-arrow-right-short"></i>
                                    </a>
                                <% } %>
                            </p>

                            <!-- Session Fee -->
                            <p class="mb-2">
                                <span class="badge bg-primary fs-6">
                                    <i class="bi bi-currency-rupee me-1"></i>
                                    Session Fee: â‚¹<%= mentor.sessionFee || "N/A" %>
                                </span>
                            </p>

                            <!-- Availability -->
                            <p class=" mb-2">
                                <i class="bi bi-calendar-check me-2"></i>
                                Availability: <%= mentor.availability || "Not specified" %>
                            </p>

                            <!-- Buttons -->
                            <% if (currUser.role === "Mentee") { %>
                            <div class="d-flex flex-column flex-md-row gap-2 mt-auto">
                                <% if (mentor.availability === "Available") { %>
                                    <form action="/scheduleSession/<%= mentor._id %>" method="GET" class="flex-fill">
                                        <button type="submit" class="btn btn-outline-success w-100">Connect</button>
                                    </form>
                                <% } %>
                                <a href="/showProfile/<%= mentor._id %>" class="btn btn-outline-success flex-fill">View Profile</a>
                            </div>
                            <% } %>

                        </div>
                    </div>
                </div>

                <!-- Bootstrap Modal for Full Bio -->
                <% if (mentor.bio && mentor.bio.split(" ").length > 13) { %>
                <div class="modal fade" id="mentorModal-<%= mentor._id %>" tabindex="-1" aria-labelledby="mentorModalLabel-<%= mentor._id %>" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow">
                      <div class="modal-header">
                        <h5 class="modal-title" id="mentorModalLabel-<%= mentor._id %>"><%= mentor.userId.name %>'s Bio</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <p><%= mentor.bio %></p>
                      </div>
                    </div>
                  </div>
                </div>
                <% } %>

            <% }) %>
        <% } else { %>
            <div class="col-12">
                <div class="alert alert-info text-center" role="alert">
                    <i class="bi bi-info-circle me-2"></i>No mentors found matching your search criteria.
                </div>
            </div>
        <% } %>
    </div>
</div>
